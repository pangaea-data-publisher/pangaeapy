

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pangaeapy.pandataset &mdash; pangaeapy 2021 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=37e646e6"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pangaeapy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme_link.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to.html">How to do common tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_documentation.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pangaeapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pangaeapy.pandataset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pangaeapy.pandataset</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Aug 21 13:31:30 2018</span>

<span class="sd">@author: Robert Huber</span>
<span class="sd">@author: Markus Stocker</span>
<span class="sd">@author: Egor Gordeev</span>
<span class="sd">@author: Aarthi Balamurugan</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span><span class="o">,</span><span class="w"> </span><span class="nn">logging.handlers</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pangaeapy.exporter.pan_netcdf_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">PanNetCDFExporter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pangaeapy.exporter.pan_frictionless_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">PanFrictionlessExporter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pangaeapy.exporter.pan_dwca_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">PanDarwinCoreAchiveExporter</span>


<div class="viewcode-block" id="PanMethod">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanMethod">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanMethod</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Method Class</span>
<span class="sd">    This class creates objects which contain the method context information for e.g. parameters and events</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : str</span>
<span class="sd">        The method id internally used in PANGAEA</span>
<span class="sd">    name : str</span>
<span class="sd">        The full name of the method</span>
<span class="sd">    terms: list</span>
<span class="sd">        a list of dictionaries containing al related terms for this method</span>
<span class="sd">        example : {&#39;id&#39;: 38477, &#39;name&#39;: &#39;carbon&#39;, &#39;semantic_uri&#39;: &#39;http://purl.obolibrary.org/obo/CHEBI_27594&#39;, &#39;ontology&#39;: 18}</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    id : str</span>
<span class="sd">        The method id internally used in PANGAEA</span>
<span class="sd">    name : str</span>
<span class="sd">        The full name of the method</span>
<span class="sd">    terms: list</span>
<span class="sd">        a list of dictionaries containing al related terms for this method</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">terms</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span></div>



<div class="viewcode-block" id="PanProject">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanProject">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanProject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Project Class</span>
<span class="sd">    This class creates objects which contain the project context information for each dataset</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    acronym : str</span>
<span class="sd">        The project acronym</span>
<span class="sd">    title : str</span>
<span class="sd">        The full title of the project</span>
<span class="sd">    URL : str</span>
<span class="sd">        The project website</span>
<span class="sd">    awardURI : str</span>
<span class="sd">        The unique identifier of the award e.g. a CORDIS URI</span>
<span class="sd">    id : int</span>
<span class="sd">        internal project id</span>



<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    acronym : str</span>
<span class="sd">        The project acronym</span>
<span class="sd">    title : str</span>
<span class="sd">        The full title of the project</span>
<span class="sd">    URL : str</span>
<span class="sd">        The project website</span>
<span class="sd">    awardURI : str</span>
<span class="sd">        The unique identifier of the award e.g. a CORDIS URI</span>
<span class="sd">    id : int</span>
<span class="sd">        internal project id</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">URL</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">awardURI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URL</span> <span class="o">=</span> <span class="n">URL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awardURI</span> <span class="o">=</span> <span class="n">awardURI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span></div>


<div class="viewcode-block" id="PanLicence">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanLicence">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanLicence</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Licence Class</span>
<span class="sd">    This class contains the licence information for each dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">URI</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URI</span> <span class="o">=</span> <span class="n">URI</span></div>


<div class="viewcode-block" id="PanAuthor">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanAuthor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanAuthor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Author Class.</span>
<span class="sd">    A simple helper class to declare &#39;author&#39; objects which are associated as part of the metadata of a given PANGAEA dataset object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lastname : str</span>
<span class="sd">        The author&#39;s first name</span>
<span class="sd">    firstname : str</span>
<span class="sd">        The authors&#39;s last name</span>
<span class="sd">    ORCID : str</span>
<span class="sd">        The unique ORCID identifier assigned by orcid.org</span>
<span class="sd">    id : int</span>
<span class="sd">        The PANGAEA internal id</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    lastname : str</span>
<span class="sd">        The author&#39;s first name</span>
<span class="sd">    firstname : str</span>
<span class="sd">        The authors&#39;s last name</span>
<span class="sd">    fullname : str</span>
<span class="sd">        Combination of lastname, firstname. This attribute is created by the constructor</span>
<span class="sd">    ORCID : str</span>
<span class="sd">        The unique ORCID identifier assigned by orcid.org</span>
<span class="sd">    id : int</span>
<span class="sd">        The PANGAEA internal id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">firstname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orcid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">affiliations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastname</span> <span class="o">=</span> <span class="n">lastname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span> <span class="o">=</span> <span class="n">firstname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ORCID</span> <span class="o">=</span> <span class="n">orcid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="n">affiliations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">affiliations</span> <span class="o">=</span> <span class="n">affiliations</span>
        <span class="k">if</span> <span class="n">firstname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span></div>


<div class="viewcode-block" id="PanEvent">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanEvent">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Event Class.</span>
<span class="sd">    An Event can be regarded as a named entity which is defined by the usage of a distinct method or device at a distinct location during a given time interval for scientific purposes.</span>
<span class="sd">    More infos on PANGAEA&#39;s Evenmts can be found here: https://wiki.pangaea.de/wiki/Event</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    label : str</span>
<span class="sd">        A label which is used to name the event</span>
<span class="sd">    latitude : float</span>
<span class="sd">        The latitude of the event location</span>
<span class="sd">    longitude : float</span>
<span class="sd">        The longitude of the event location</span>
<span class="sd">    elevation : float</span>
<span class="sd">        The elevation (relative to sea level) of the event location</span>
<span class="sd">    datetime : str</span>
<span class="sd">        The date and time of the event in ´%Y/%m/%dT%H:%M:%S´ format</span>
<span class="sd">    device : str</span>
<span class="sd">        The device which was used during the event</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    label : str</span>
<span class="sd">        A label which is used to name the event</span>
<span class="sd">    latitude : float</span>
<span class="sd">        The start latitude of the event location</span>
<span class="sd">    longitude : float</span>
<span class="sd">        The start longitude of the event location</span>
<span class="sd">    latitude2 : float</span>
<span class="sd">        The end latitude of the event location</span>
<span class="sd">    longitude2 : float</span>
<span class="sd">        The end longitude of the event location</span>
<span class="sd">    elevation : float</span>
<span class="sd">        The elevation (relative to sea level) of the event location</span>
<span class="sd">    datetime : str</span>
<span class="sd">        The start date and time of the event in ´%Y/%m/%dT%H:%M:%S´ format</span>
<span class="sd">    datetime2 : str</span>
<span class="sd">        The end date and time of the event in ´%Y/%m/%dT%H:%M:%S´ format</span>
<span class="sd">    device : str</span>
<span class="sd">        The device which was used during the event</span>
<span class="sd">    basis : PanBasis</span>
<span class="sd">        The basis or platform which was used during the event e.g. a ship</span>
<span class="sd">    location : str</span>
<span class="sd">        The location of the event</span>
<span class="sd">    campaign : PanCampaign</span>
<span class="sd">        The campaign during which the event was performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">label</span><span class="p">,</span>
                 <span class="n">latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">longitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">latitude2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">longitude2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">elevation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">datetime2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">campaign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="nb">id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">latitude2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latitude2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">latitude2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latitude2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">longitude2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">longitude2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">longitude2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">longitude2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">elevation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">PanMethod</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deviceid</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviceid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="c1"># -- NEED TO CARE ABOUT datetime2!!!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime2</span> <span class="o">=</span> <span class="n">datetime2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">campaign</span> <span class="o">=</span> <span class="n">campaign</span></div>


<div class="viewcode-block" id="PanBasis">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanBasis">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanBasis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Basis class</span>
<span class="sd">    The basis or platform which was used during the event e.g. a ship</span>

<span class="sd">    name : str</span>
<span class="sd">        The name of the platform</span>
<span class="sd">    URI : str</span>
<span class="sd">        The platform URI</span>
<span class="sd">    callSign : str</span>
<span class="sd">        A unique identifier of the platform(alphabet)</span>
<span class="sd">    IMOnumber : str</span>
<span class="sd">        A seven digit unique identifier for the platform</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">URI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callSign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IMOnumber</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URI</span> <span class="o">=</span> <span class="n">URI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callSign</span> <span class="o">=</span> <span class="n">callSign</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IMOnumber</span> <span class="o">=</span> <span class="n">IMOnumber</span></div>


<div class="viewcode-block" id="PanCampaign">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanCampaign">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanCampaign</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Campaign class</span>
<span class="sd">    The campaign during which the event took place, e.g. a ship cruise or observatory deployment</span>

<span class="sd">    name : str</span>
<span class="sd">        The name of the campaign</span>
<span class="sd">    URI : str</span>
<span class="sd">        The campaign URI</span>
<span class="sd">    start : str</span>
<span class="sd">        The start date of the campaign</span>
<span class="sd">    end : str</span>
<span class="sd">        The end date of the campaign</span>
<span class="sd">    startlocation : str</span>
<span class="sd">        The start location of the campaign</span>
<span class="sd">    endlocation : str</span>
<span class="sd">        The end location of the campaign</span>
<span class="sd">    BSHID : str</span>
<span class="sd">        The BSH ID for the campaign</span>
<span class="sd">    expeditionprogram: str</span>
<span class="sd">        URL of the campaign report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">URI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startlocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endlocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">BSHID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expeditionprogram</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URI</span> <span class="o">=</span> <span class="n">URI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startlocation</span> <span class="o">=</span> <span class="n">startlocation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endlocation</span> <span class="o">=</span> <span class="n">endlocation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BSHID</span> <span class="o">=</span> <span class="n">BSHID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expeditionprogram</span> <span class="o">=</span> <span class="n">expeditionprogram</span></div>


<div class="viewcode-block" id="PanParam">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanParam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanParam</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA Parameter</span>
<span class="sd">    Shoud be used to create PANGAEA parameter objects. Parameter is used here to represent &#39;measured variables&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : int</span>
<span class="sd">        the identifier for the parameter</span>
<span class="sd">    name : str</span>
<span class="sd">        A long name or title used for the parameter</span>
<span class="sd">    shortName : str</span>
<span class="sd">        A short name or label to identify the parameter</span>
<span class="sd">    param_type : str</span>
<span class="sd">        indicates the data type of the parameter (string, numeric, datetime etc..)</span>
<span class="sd">    source : str</span>
<span class="sd">        defines the category or source for a parameter (e.g. geocode, data, event)... very PANGAEA specific ;)</span>
<span class="sd">    unit : str</span>
<span class="sd">        the unit of measurement used with this parameter (e.g. m/s, kg etc..)</span>
<span class="sd">    terms : list</span>
<span class="sd">        a list of dictionaries containing all related terms for this parameter structure:</span>
<span class="sd">        example: [{&#39;id&#39;: 38477, &#39;name&#39;: &#39;carbon&#39;, &#39;semantic_uri&#39;: &#39;http://purl.obolibrary.org/obo/CHEBI_27594&#39;, &#39;ontology&#39;: 18}, {&#39;id&#39;: 44419, &#39;name&#39;: &#39;organic&#39;, &#39;semantic_uri&#39;: None, &#39;ontology&#39;: 18}, {&#39;id&#39;: 44029, &#39;name&#39;: &#39;Molar Flux&#39;, &#39;semantic_uri&#39;: None, &#39;ontology&#39;: 13}]</span>

<span class="sd">    comment : str</span>
<span class="sd">        an optional comment explaining some details of the parameter</span>
<span class="sd">    PI : dict</span>
<span class="sd">        the responsible PI name of the parameter</span>
<span class="sd">    dataseries : int</span>
<span class="sd">        the dataseries (column id)</span>
<span class="sd">    colno : int</span>
<span class="sd">        the column number</span>
<span class="sd">    method : PanMethod</span>
<span class="sd">        the used method or device</span>



<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    id : int</span>
<span class="sd">        the identifier for the parameter</span>
<span class="sd">    name : str</span>
<span class="sd">        A long name or title used for the parameter</span>
<span class="sd">    shortName : str</span>
<span class="sd">        A short name or label to identify the parameter</span>
<span class="sd">    synonym : dict</span>
<span class="sd">        A dictionary of synonyms for the parameter whcih e.g. is used by other archives or communities.</span>
<span class="sd">        The dict key indicates the namespace (possible values currently are CF and OS)</span>
<span class="sd">    type : str</span>
<span class="sd">        indicates the data type of the parameter (string, numeric, datetime etc..)</span>
<span class="sd">    source : str</span>
<span class="sd">        defines the category or source for a parameter (e.g. geocode, data, event)... very PANGAEA specific ;)</span>
<span class="sd">    unit : str</span>
<span class="sd">        the unit of measurement used with this parameter (e.g. m/s, kg etc..)</span>
<span class="sd">    format: str</span>
<span class="sd">        the number format string given by PANGAEA e.g ##.000 which defines the displayed precision of the number</span>
<span class="sd">    terms : list</span>
<span class="sd">        a list of dictionaries containing all related terms for this parameter</span>
<span class="sd">    comment : str</span>
<span class="sd">        an optional comment explaining some details of the parameter</span>
<span class="sd">    PI : dict</span>
<span class="sd">        the responsible PI name of the parameter</span>
<span class="sd">    dataseries : int</span>
<span class="sd">        the dataseries (column id)</span>
<span class="sd">    colno : int</span>
<span class="sd">        the column number</span>
<span class="sd">    methodid : int</span>
<span class="sd">        the id of the used method or device (legacy only)</span>
<span class="sd">    method : PanMethod</span>
<span class="sd">        the  method (object) used</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortName</span><span class="p">,</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unit_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">terms</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">PI</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="n">dataseries</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">colno</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methodid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">PanMethod</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">methodid</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="o">=</span><span class="n">shortName</span>
        <span class="c1"># Synonym namespace dict predefined keys are CF: CF variables (), OS:OceanSites, SD:SeaDataNet abbreviations (TEMP, PSAL etc..)</span>
        <span class="n">ns</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;CF&#39;</span><span class="p">,</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span><span class="s1">&#39;SD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">synonym</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">param_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">=</span><span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit_id</span> <span class="o">=</span> <span class="n">unit_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">=</span><span class="nb">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span><span class="n">terms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PI</span> <span class="o">=</span> <span class="n">PI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataseries</span> <span class="o">=</span> <span class="n">dataseries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colno</span> <span class="o">=</span> <span class="n">colno</span>

<div class="viewcode-block" id="PanParam.addSynonym">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanParam.addSynonym">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addSynonym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new synonym for a parameter which is valid within the given name space. Synonyms are stored in the synonym attribute which is a dictionary</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            the name of the synonym</span>
<span class="sd">        id : str</span>
<span class="sd">            the internal ID of the term used at its auhority ontology</span>
<span class="sd">        uri : str</span>
<span class="sd">            the URI (ideally actionable) leading to its auhority ontology entry/web page</span>
<span class="sd">        ns : str</span>
<span class="sd">            the namespace indicator for the sysnonym</span>
<span class="sd">        unit : str</span>
<span class="sd">            in case another unit expression is used for the synonym parameter within its namespace</span>
<span class="sd">        unit_id : str</span>
<span class="sd">            the id, UI or URN for the unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">synonym</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span> <span class="s2">&quot;unit_id&quot;</span><span class="p">:</span> <span class="n">unit_id</span><span class="p">}</span></div>
</div>


<div class="viewcode-block" id="PanDataSet">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PanDataSet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PANGAEA DataSet</span>
<span class="sd">    The PANGAEA PanDataSet class enables the creation of objects which hold the necessary information, including data as well as metadata, to analyse a given PANGAEA dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : str</span>
<span class="sd">        The identifier of a PANGAEA dataset. An integer number or a DOI is accepted here</span>
<span class="sd">    deleteFlag : str</span>
<span class="sd">        in case quality flags are avialable, this parameter defines a flag for which data should not be included in the data dataFrame.</span>
<span class="sd">        Possible values are listed here: https://wiki.pangaea.de/wiki/Quality_flag</span>
<span class="sd">    enable_cache : boolean</span>
<span class="sd">        If set to True, PanDataSet objects are cached as pickle files either on the local home directory within a directory called &#39;pangaeapy_cache&#39; or in cache_dir given by the user in order to avoid unnecessary downloads.</span>
<span class="sd">    include_data : boolean</span>
<span class="sd">        determines if data table is downloaded and added to the self.data dataframe. If you are interested in metadata only set this to False</span>
<span class="sd">    expand_terms : list or int</span>
<span class="sd">        indicates if found ontology terms for parameters shall be expanded for the given list of terminology ids, i.p. add their hierarchy terms / classification</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    id : str</span>
<span class="sd">        The identifier of a PANGAEA dataset. An integer number or a DOI is accepted here</span>
<span class="sd">    uri : str</span>
<span class="sd">        The PANGAEA DOI (alternative label)</span>
<span class="sd">    doi : str</span>
<span class="sd">        The PANGAEA DOI</span>
<span class="sd">    title : str</span>
<span class="sd">        The title of the dataset</span>
<span class="sd">    abstract: str</span>
<span class="sd">        the abstract or summary of the dataset</span>
<span class="sd">    year : int</span>
<span class="sd">        The publication year of the dataset</span>
<span class="sd">    authors : list of PanAuthor</span>
<span class="sd">        a list containing the PanAuthot objects (author info) of the dataset</span>
<span class="sd">    citation : str</span>
<span class="sd">        the full citation of the dataset including e.g. author, year, title etc..</span>
<span class="sd">    params : list of PanParam</span>
<span class="sd">        a list of all PanParam objects (the parameters) used in this dataset</span>
<span class="sd">    parameters : list of PanParam</span>
<span class="sd">        synonym for self.params</span>
<span class="sd">    events : list of PanEvent</span>
<span class="sd">        a list of all PanEvent objects (the events) used in this dataset</span>
<span class="sd">    projects : list of PanProject</span>
<span class="sd">        a list containing the PanProjects objects referenced by this dataset</span>
<span class="sd">    mintimeextent : str</span>
<span class="sd">        a string containing the min time of data set extent</span>
<span class="sd">    maxtimeextent : str</span>
<span class="sd">        a string containing the max time of data set extent</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        a pandas dataframe holding all the data</span>
<span class="sd">    loginstatus : str</span>
<span class="sd">        a label which indicates if the data set is protected or not default value: &#39;unrestricted&#39;</span>
<span class="sd">    isCollection : boolean</span>
<span class="sd">        indicates if this dataset is a collection data set within a collection of child data sets</span>
<span class="sd">    collection_members : list</span>
<span class="sd">        a list of DOIs of all child data sets in case the data set is a collection data set</span>
<span class="sd">    moratorium : str</span>
<span class="sd">        a label which provides the date until the dataset is under moratorium</span>
<span class="sd">    datastatus : str</span>
<span class="sd">        a label which provides the detail about the status of the dataset whether it is published or in review or deleted</span>
<span class="sd">    registrystatus : str</span>
<span class="sd">        a string which indicates the registration status of a dataset</span>
<span class="sd">    licence : PanLicence</span>
<span class="sd">        a licence object, usually creative commons</span>
<span class="sd">    auth_token : str</span>
<span class="sd">        the PANGAEA auhentication token, you can find it at pangaea.de on your user page</span>
<span class="sd">    cache_expiry_days : int</span>
<span class="sd">        the duration a cached pickle/cache is accepted, after this pangaeapy will load it again and ignor ethe cache</span>
<span class="sd">    cache_dir: str</span>
<span class="sd">        the full path to the cache directory, will be created if it doesn&#39;t exist</span>
<span class="sd">    keywords : list[str]</span>
<span class="sd">        A list of keyword names. Only actual keywords, technical and</span>
<span class="sd">        auto-generated ones are ignored right now.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paramlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deleteFlag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">enable_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">cache_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expand_terms</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">auth_token</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cache_expiry_days</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doi</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span>  <span class="c1"># the doi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">)</span>
        <span class="c1">### The constructor allows the initialisation of a PANGAEA dataset object either by using an integer dataset id or a DOI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;md&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.pangaea.de/MetaData&quot;</span><span class="p">}</span>
        <span class="c1"># Mapping should be moved to e.g. netCDF class/module??</span>
        <span class="c1">#moddir = os.path.dirname(os.path.abspath(__file__))</span>
        <span class="c1">#self.CFmapping=pd.read_csv(moddir+&#39;\\PANGAEA_CF_mapping.txt&#39;,delimiter=&#39;\t&#39;,index_col=&#39;ID&#39;)</span>
        <span class="c1"># setting up the cache directory in the users home folder if no path is given</span>
        <span class="k">if</span> <span class="n">cache_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">homedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">homedir</span><span class="p">,</span> <span class="s2">&quot;pangaeapy_cache&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span> <span class="o">=</span> <span class="n">cache_dir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">enable_cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_expiry_days</span> <span class="o">=</span> <span class="n">cache_expiry_days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isCollection</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultparams</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;Elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span> <span class="o">=</span> <span class="n">paramlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">licence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># allowed geocodes for netcdf generation which are used as xarray dimensions not needed in the moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geocodes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1599</span><span class="p">:</span> <span class="s2">&quot;Date_Time&quot;</span><span class="p">,</span> <span class="mi">1600</span><span class="p">:</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="mi">1601</span><span class="p">:</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="mi">1619</span><span class="p">:</span> <span class="s2">&quot;Depth water&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moratorium</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curationlevel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processinglevel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastatus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registrystatus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">citation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mintimeextent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxtimeextent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">topotype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># temporary cache for terms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="s2">&quot;terms.db&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supplement_to</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># If this dataset is supllementary to another publication, give that publications title and URI here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of relations as given in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of keywords</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;create table if not exists terms (term_id integer PRIMARY KEY, term_name text, term_json text, entry_date datetime default current_timestamp)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DB INIT ERROR: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="c1"># replacing error list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loginstatus</span> <span class="o">=</span> <span class="s2">&quot;unrestricted&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowNetCDF</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eventInMatrix</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">=</span> <span class="n">deleteFlag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_data</span> <span class="o">=</span> <span class="n">include_data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expand_terms</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">expand_terms</span> <span class="o">=</span> <span class="p">[</span><span class="n">expand_terms</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expand_terms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">expand_terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_terms</span> <span class="o">=</span> <span class="n">expand_terms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastupdate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaxml</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span>

        <span class="c1"># no symbol = valid(default)</span>
        <span class="c1"># ? = questionable(?0.345)</span>
        <span class="c1"># / = not valid( / 23.56)</span>
        <span class="c1"># * = unknown(*0.999)</span>
        <span class="c1"># = individual definition (#999)</span>
        <span class="c1">#self.logger.info(&#39;Test&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality_flags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ok&#39;</span><span class="p">:</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">:</span><span class="s1">&#39;questionable&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">:</span><span class="s1">&#39;not_valid&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">:</span><span class="s1">&#39;unknown&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality_flag_replace</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ok&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gotData</span><span class="o">=</span><span class="kc">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;INFO&#39;:&#39;Caching activated..trying to load data and metadata from cache&#39;})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Caching activated..trying to load data and metadata from cache&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_pickle</span><span class="p">():</span>
                    <span class="n">gotData</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_pickle</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drop_pickle</span><span class="p">()</span>
                    <span class="n">gotData</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># delete existing cache</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drop_pickle</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gotData</span><span class="p">:</span>
                <span class="c1"># print(&#39;trying to load data and metadata from PANGAEA&#39;)</span>
                <span class="c1"># check if title is already there, otherwise load metadata</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setMetadata</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loginstatus</span> <span class="o">==</span> <span class="s2">&quot;unrestricted&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCollection</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setData</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">defaultparams</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultparams</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span><span class="p">):</span>
                            <span class="c1"># self.logging.append({&#39;WARNING&#39;:&#39;Inconsistent number of detected parameters, expected: &#39;+str(len(self.paramlist))+&#39; vs &#39;+str(len(self.paramlist_index))})</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Inconsistent number of detected parameters, expected: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; vs &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s1">&#39;Dataset is either restricted or of type &quot;collection&quot;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.logging.append({&#39;ERROR&#39;:&#39;Dataset id missing, could not initialize PanDataSet object for: &#39;+str(id)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Dataset id missing, could not initialize PanDataSet object for: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="p">)</span>
        <span class="n">loglevel</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">loglevel</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pickle_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cachedir</span><span class="p">,</span> <span class="o">*</span><span class="n">dirs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_data.pik&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PanDataSet.check_pickle">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.check_pickle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies if a cached pickle files needs to be refreshed (reloaded)</span>
<span class="sd">        Files are checked after 24 hrs earliest but only updated in case the metadata indicates changes occured</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expirydays</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pickle_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_location</span><span class="p">):</span>
            <span class="n">pickle_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">pickle_location</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">pickle_time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_expiry_days</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setMetadata</span><span class="p">()</span>
                <span class="c1"># 2016-10-08T05:40:17</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># print(&#39;LAST UPDATE: &#39;,self.doi, self.lastupdate, self.cache_expiry_days)</span>
                    <span class="n">lastupdatets</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastupdate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
                    <span class="c1"># print(int(lastupdatets) , int(pickle_time))</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">lastupdatets</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pickle_time</span><span class="p">):</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="c1"># self.logging.append(</span>
                        <span class="c1">#    {&#39;INFO&#39;: &#39;Dataset cache expired, refreshing cache&#39;})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Dataset cache expired, refreshing cache&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">pass</span>
            <span class="k">return</span> <span class="n">ret</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">drop_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">()):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">())</span>

<div class="viewcode-block" id="PanDataSet.from_pickle">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.from_pickle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a PanDataSet object from a pickle file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pickle_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
                <span class="n">tmp_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">tmp_dict</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp_dict</span><span class="p">)</span>
                <span class="c1"># self.logging.append({&#39;INFO&#39;:&#39;Loading data and metadata from cache: &#39;+str(pickle_path)})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading data and metadata from cache: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">))</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;WARNING&#39;:&#39;Loading data and metadata from cache failed&#39;})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Loading data and metadata from cache failed&quot;</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="PanDataSet.to_pickle">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.to_pickle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a PanDataSet object to a pickle file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">(),</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;terms_conn&quot;</span><span class="p">]</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># self.logging.append({&#39;INFO&#39;: &#39;Saved cache (pickle) file at: &#39; + str(self.get_pickle_path())})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Saved cache (pickle) file at: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pickle_path</span><span class="p">()))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Skipped saving cache (pickle) since the dataset contains no data&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PanDataSet.setID">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.setID">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ID of a data set in case it was not defined in the constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : str</span>
<span class="sd">            The identifier of a PANGAEA dataset. An integer number or a DOI is accepted here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">idmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;10\.1594\/PANGAEA\.([0-9]+)$&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idmatch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">idmatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Invalid Identifier or DOI: &#39;+str(id)})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Invalid Identifier or DOI: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
                <span class="c1"># print(&#39;Invalid Identifier&#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Invalid Identifier or DOI: &#39; + str(id)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Invalid Identifier or DOI: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getIDParts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idstr</span><span class="p">):</span>
        <span class="c1"># returns dict extracted from panmd id strings e.g</span>
        <span class="c1"># col13.ds10866878.param7387</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idstr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">idmatches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([a-z]+)([0-9]+)&quot;</span><span class="p">,</span> <span class="n">idstr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idmatches</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">idmatches</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setEvents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panXMLEvents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the list of Events from a metadata XML file for a given pangaea dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">panXMLEvents</span><span class="p">:</span>
            <span class="n">eventElevation</span> <span class="o">=</span> <span class="n">eventDateTime</span> <span class="o">=</span> <span class="n">eventDateTime2</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eventDevice</span> <span class="o">=</span> <span class="n">eventLabel</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eventDeviceID</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">basis_name</span> <span class="o">=</span> <span class="n">basis_URI</span> <span class="o">=</span> <span class="n">basis_callsign</span> <span class="o">=</span> <span class="n">basis_imonumber</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">campaign_name</span> <span class="o">=</span> <span class="n">campaign_URI</span> <span class="o">=</span> <span class="n">campaign_start</span> <span class="o">=</span> <span class="n">campaign_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eventLongitude</span> <span class="o">=</span> <span class="n">eventLatitude</span> <span class="o">=</span> <span class="n">eventLatitude2</span> <span class="o">=</span> <span class="n">eventLongitude2</span> <span class="o">=</span> <span class="n">eventLocation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">startlocation</span> <span class="o">=</span> <span class="n">endlocation</span> <span class="o">=</span> <span class="n">BSHID</span> <span class="o">=</span> <span class="n">expeditionprogram</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">eventID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:elevation&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventElevation</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:elevation&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:dateTime&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventDateTime</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:dateTime&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:dateTime2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventDateTime2</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:dateTime2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:longitude&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLongitude</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:longitude&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:latitude&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLatitude</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:latitude&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:longitude2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLongitude2</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:longitude2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:latitude2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLatitude2</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:latitude2&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLabel</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:location/md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventLocation</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:location/md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method/md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eventDeviceTerms</span> <span class="o">=</span><span class="p">[]</span>
                <span class="n">eventDevice</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method/md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">eventDeviceID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">terminfo</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;md:method/md:term&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                    <span class="n">eventDeviceTerms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getTermInfo</span><span class="p">(</span><span class="n">terminfo</span><span class="p">))</span>
                <span class="n">eventMethod</span> <span class="o">=</span> <span class="n">PanMethod</span><span class="p">(</span><span class="n">eventDeviceID</span><span class="p">,</span> <span class="n">eventDevice</span><span class="p">,</span><span class="n">eventDeviceTerms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eventMethod</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:basis&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">basis</span><span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:basis&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">basis_name</span><span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">basis_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">basis_URI</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">basis_URI</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:callSign&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">basis_callsign</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:callSign&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">basis_callsign</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:IMOnumber&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">basis_imonumber</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:IMOnumber&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">basis_imonumber</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">eventBasis</span> <span class="o">=</span> <span class="n">PanBasis</span><span class="p">(</span><span class="n">basis_name</span><span class="p">,</span> <span class="n">basis_URI</span><span class="p">,</span> <span class="n">basis_callsign</span><span class="p">,</span> <span class="n">basis_imonumber</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eventBasis</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:campaign&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">campaign</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:campaign&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">campaign_name</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">campaign_URI</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:start&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">campaign_start</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:start&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:end&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">campaign_end</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:end&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;Start location&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">startlocation</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;Start location&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;End location&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">endlocation</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;End location&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;BSH ID&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">BSHID</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;BSH ID&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;Expedition Program&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expeditionprogram</span> <span class="o">=</span> <span class="n">campaign</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:attribute[@name=&quot;Expedition Program&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expeditionprogram</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">eventCampaign</span> <span class="o">=</span> <span class="n">PanCampaign</span><span class="p">(</span><span class="n">campaign_name</span><span class="p">,</span> <span class="n">campaign_URI</span><span class="p">,</span> <span class="n">campaign_start</span><span class="p">,</span> <span class="n">campaign_end</span><span class="p">,</span> <span class="n">startlocation</span><span class="p">,</span> <span class="n">endlocation</span><span class="p">,</span> <span class="n">BSHID</span><span class="p">,</span> <span class="n">expeditionprogram</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eventCampaign</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PanEvent</span><span class="p">(</span><span class="n">eventLabel</span><span class="p">,</span> 
                                        <span class="n">eventLatitude</span><span class="p">,</span> 
                                        <span class="n">eventLongitude</span><span class="p">,</span>
                                        <span class="n">eventLatitude2</span><span class="p">,</span>
                                        <span class="n">eventLongitude2</span><span class="p">,</span>
                                        <span class="n">eventElevation</span><span class="p">,</span>
                                        <span class="n">eventDateTime</span><span class="p">,</span>
                                        <span class="n">eventDateTime2</span><span class="p">,</span>
                                        <span class="n">eventBasis</span><span class="p">,</span>
                                        <span class="n">eventLocation</span><span class="p">,</span>
                                        <span class="n">eventCampaign</span><span class="p">,</span>
                                        <span class="n">eventID</span><span class="p">,</span>
                                        <span class="n">eventMethod</span>
                                        <span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getExtendedTermInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">termid</span><span class="p">):</span>
        <span class="n">termJSON</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">selsql</span> <span class="o">=</span> <span class="s2">&quot;select * from terms where term_id=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">termid</span><span class="p">)</span>
            <span class="n">tres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">selsql</span><span class="p">)</span>
            <span class="n">found_term</span> <span class="o">=</span> <span class="n">tres</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">found_term</span><span class="p">:</span>
                <span class="n">termJSON</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">found_term</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getTermInfo ERROR I : &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">termJSON</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">termr</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://ws.pangaea.de/es/pangaea-terms/term/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">termid</span><span class="p">))</span>
                <span class="n">termJSON</span> <span class="o">=</span> <span class="n">termr</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">term_name</span> <span class="o">=</span> <span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">inssql</span> <span class="o">=</span> <span class="s2">&quot;insert into terms (term_id, term_name, term_json) values (?,?,?)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">inssql</span><span class="p">,</span> <span class="p">(</span><span class="n">termid</span><span class="p">,</span> <span class="n">term_name</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">termJSON</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">terms_conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getTermInfo ERROR II: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">inssql</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">termJSON</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getTermInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">terminfo</span><span class="p">,</span> <span class="n">terminology_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses terms webservice to enrich the parameter info with linked terms and their classification</span>
<span class="sd">        terminology_id: restrict to given terminology</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">termret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">termid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">termname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">terminfo</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">termname</span> <span class="o">=</span> <span class="n">terminfo</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">termidparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">terminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">termidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;term&quot;</span><span class="p">):</span>
                <span class="n">termid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">termidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;term&quot;</span><span class="p">))</span>
            <span class="n">terminologyid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">terminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;terminologyId&quot;</span><span class="p">))</span>
            <span class="n">termuri</span> <span class="o">=</span> <span class="n">terminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;semanticURI&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_terms</span> <span class="ow">and</span> <span class="p">(</span><span class="n">terminologyid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_terms</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">termid</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">termid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">termJSON</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtendedTermInfo</span><span class="p">(</span><span class="n">termid</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">termJSON</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_source&quot;</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">[</span><span class="n">termid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="k">if</span> <span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;main_topics&quot;</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;main_topics&quot;</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">[</span><span class="n">termid</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;main_topics&quot;</span><span class="p">))</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">[</span><span class="n">termid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;main_topics&quot;</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topics&quot;</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topics&quot;</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">[</span><span class="n">termid</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topics&quot;</span><span class="p">))</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="p">[</span><span class="n">termid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">termJSON</span><span class="p">[</span><span class="s2">&quot;_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topics&quot;</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Failed loading and parsing PANGAEA Term JSON: &#39; + str(e)})</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Failed loading and parsing PANGAEA Term JSON: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_terms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">termid</span><span class="p">):</span>
                    <span class="n">classification</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">termid</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">classification</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># print(termid, classification)</span>
                <span class="n">termret</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">termid</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">termname</span><span class="p">),</span> <span class="s2">&quot;semantic_uri&quot;</span><span class="p">:</span> <span class="n">termuri</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="n">terminologyid</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span> <span class="n">classification</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">termret</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">termid</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">termname</span><span class="p">),</span> <span class="s2">&quot;semantic_uri&quot;</span><span class="p">:</span> <span class="n">termuri</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="n">terminologyid</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Failed to expand terms &#39; + (str(e))})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Failed to expand terms &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">termret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panXMLMatrixColumn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the list of parameter objects from the metadata XML info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coln</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">panXMLMatrixColumn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">panGeoCode</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">panXMLMatrixColumn</span><span class="p">:</span>
                <span class="n">panparCFName</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">colno</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">)</span>
                <span class="n">paramstr</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:parameter&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                <span class="c1"># panparID=int(self._getID(str(paramstr.get(&#39;id&#39;))))</span>
                <span class="n">paramidparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">paramstr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)))</span>
                <span class="n">panparID</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dataseriesID</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;param&quot;</span><span class="p">):</span>
                    <span class="n">panparID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;param&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geocode&quot;</span><span class="p">):</span>
                    <span class="n">panparID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;geocode&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">):</span>
                    <span class="n">dataseriesID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">paramidparts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">))</span>
                <span class="n">panparShortName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">paramstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:shortName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">panparShortName</span> <span class="o">=</span> <span class="n">paramstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:shortName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">panparIndex</span> <span class="o">=</span> <span class="n">panparShortName</span>
                    <span class="c1"># Rename duplicate column headers</span>
                    <span class="k">if</span> <span class="n">panparShortName</span> <span class="ow">in</span> <span class="n">coln</span><span class="p">:</span>
                        <span class="n">coln</span><span class="p">[</span><span class="n">panparShortName</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">panparIndex</span> <span class="o">=</span> <span class="n">panparShortName</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coln</span><span class="p">[</span><span class="n">panparShortName</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coln</span><span class="p">[</span><span class="n">panparShortName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">panparType</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                <span class="n">panparUnit</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span><span class="p">(</span><span class="n">paramstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:unit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">panparUnit</span><span class="o">=</span><span class="n">paramstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:unit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">panparComment</span><span class="o">=</span><span class="kc">None</span>
                <span class="k">if</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:comment&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">panparComment</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:comment&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">panparMethod</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">panparMethodTerms</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">panparMethodName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">panparMethodName</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">panparMethodID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:method&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">pmterminfo</span> <span class="ow">in</span> <span class="n">matrix</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;md:method/md:term&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                        <span class="n">panparMethodTerms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getTermInfo</span><span class="p">(</span><span class="n">pmterminfo</span><span class="p">))</span>
                    <span class="n">panparMethod</span> <span class="o">=</span> <span class="n">PanMethod</span><span class="p">(</span><span class="n">panparMethodID</span><span class="p">,</span> <span class="n">panparMethodName</span><span class="p">,</span><span class="n">panparMethodTerms</span><span class="p">)</span>
                <span class="n">panparPI</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">panparPI_firstname</span><span class="p">,</span> <span class="n">panparPI_lastname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:PI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">panparPI_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIDParts</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:PI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:PI/md:firstName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">panparPI_firstname</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:PI/md:firstName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">panparPI_lastname</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:PI/md:lastName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">panparPI_fullname</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">panparPI_lastname</span><span class="p">,</span> <span class="n">panparPI_firstname</span><span class="p">]))</span>
                    <span class="n">panparPI</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">panparPI_ID</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">panparPI_fullname</span><span class="p">,</span> <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">panparPI_lastname</span><span class="p">,</span> <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">panparPI_firstname</span><span class="p">}</span>
                <span class="n">panparFormat</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">panparShortName</span> <span class="o">==</span> <span class="s2">&quot;Event&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eventInMatrix</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># if panparID in self.CFmapping.index:</span>
                <span class="c1">#    panparCFName=self.CFmapping.at[panparID,&#39;STDNAME&#39;]</span>
                <span class="c1"># Add information about terms/ontologies used:</span>
                <span class="n">termlist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">terminfo</span> <span class="ow">in</span> <span class="n">paramstr</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;md:term&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                    <span class="n">termlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getTermInfo</span><span class="p">(</span><span class="n">terminfo</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">panparIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">panparID</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">paramstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;md:name&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="n">shortName</span><span class="o">=</span><span class="n">panparShortName</span><span class="p">,</span><span class="n">param_type</span><span class="o">=</span><span class="n">panparType</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">),</span><span class="n">unit</span><span class="o">=</span><span class="n">panparUnit</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="n">panparFormat</span><span class="p">,</span><span class="n">terms</span><span class="o">=</span><span class="n">termlist</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">panparComment</span><span class="p">,</span><span class="n">PI</span> <span class="o">=</span><span class="n">panparPI</span><span class="p">,</span> <span class="n">dataseries</span> <span class="o">=</span> <span class="n">dataseriesID</span><span class="p">,</span> <span class="n">colno</span> <span class="o">=</span> <span class="n">colno</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">panparMethod</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
                <span class="k">if</span> <span class="n">panparType</span> <span class="o">==</span> <span class="s2">&quot;geocode&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">panparShortName</span> <span class="ow">in</span> <span class="n">panGeoCode</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">allowNetCDF</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Data set contains duplicate Geocodes&#39;})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data set contains duplicate Geocodes&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">panGeoCode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panparShortName</span><span class="p">)</span>

<div class="viewcode-block" id="PanDataSet.getEventsAsFrame">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.getEventsAsFrame">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getEventsAsFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For more convenient handling of event info, this method returns a dataframe containing all events with their attributes as columns</span>
<span class="sd">        Please note that this version just takes campaign names, not other campaign attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">ev</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">])</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;campaign&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;campaign&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="PanDataSet.setData">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.setData">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addEventColumns</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method populates the data DataFrame with data from a PANGAEA dataset.</span>
<span class="sd">        In addition to the data given in the tabular ASCII file delivered by PANGAEA.</span>


<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        addEventColumns : boolean</span>
<span class="sd">            In case Latitude, Longititude, Elevation, Date/Time and Event are not given in the ASCII matrix, which sometimes is possible in single Event datasets,</span>
<span class="sd">            the setData could add these columns to the dataframe using the information given in the metadata for Event. Default is &#39;True&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># converting list of parameters` short names (from user input) to the list of parameters` indexes</span>
        <span class="c1"># the list of parameters` indexes is an argument for pd.read_csv</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultparams</span>
            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span><span class="p">:</span>
                <span class="nb">iter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">shortName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">parameter</span> <span class="o">==</span> <span class="n">shortName</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">iter</span><span class="p">)</span>
                    <span class="nb">iter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span><span class="p">):</span>
                <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Error entering parameters`short names, inconsitent number of parameters&#39;})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Error entering parameters`short names, inconsitent number of parameters&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataURL</span> <span class="o">=</span> <span class="s2">&quot;https://doi.pangaea.de/10.1594/PANGAEA.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">requestheader</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/tab-separated-values&quot;</span><span class="p">}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
                    <span class="n">requestheader</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>
                <span class="n">dataResponse</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dataURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">requestheader</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="n">sleeptime</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">dataResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry-after&quot;</span><span class="p">):</span>
                        <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">dataResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry-after&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">sleeptime</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Received too many requests (for data) error (429)...waiting &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
                    <span class="n">dataResponse</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dataURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">requestheader</span><span class="p">)</span>
                    <span class="c1"># self.logging.append({&#39;INFO&#39;:&#39;After repeating request, got status code: &#39;+str(r.status_code)})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;After repeating (for data) request, got status code: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>

                <span class="n">panDataTxt</span> <span class="o">=</span> <span class="n">dataResponse</span><span class="o">.</span><span class="n">text</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)):</span>
                        <span class="n">panData</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/\*(.*)\*/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">panDataTxt</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="c1"># Read in PANGAEA Data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">panData</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paramlist_index</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># add geocode/dimension columns from Event</span>

                        <span class="c1"># if addEventColumns==True and self.topotype!=&quot;not specified&quot;:</span>
                        <span class="k">if</span> <span class="n">addEventColumns</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="s2">&quot;Event&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">addEvLat</span> <span class="o">=</span> <span class="n">addEvLon</span> <span class="o">=</span> <span class="n">addEvEle</span> <span class="o">=</span> <span class="n">addEvDat</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">if</span> <span class="s2">&quot;Event&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="s2">&quot;Latitude&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                        <span class="n">addEvLat</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="mi">1600</span><span class="p">,</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="s2">&quot;Longitude&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                        <span class="n">addEvLon</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="mi">1601</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="s2">&quot;Elevation&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                        <span class="n">addEvEle</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Elevation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Elevation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="mi">8128</span><span class="p">,</span> <span class="s2">&quot;Elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;Elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="s2">&quot;Date/Time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                        <span class="n">addEvDat</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="mi">1599</span><span class="p">,</span> <span class="s2">&quot;Date/Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Date/Time&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">iev</span><span class="p">,</span> <span class="n">pevent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
                                        <span class="k">if</span> <span class="n">pevent</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">addEvLat</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pevent</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()),</span> <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">iev</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span>
                                        <span class="k">if</span> <span class="n">pevent</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">addEvLon</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pevent</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()),</span> <span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">iev</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span>
                                        <span class="k">if</span> <span class="n">pevent</span><span class="o">.</span><span class="n">elevation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">addEvEle</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pevent</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Elevation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()),</span> <span class="p">[</span><span class="s2">&quot;Elevation&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">iev</span><span class="p">]</span><span class="o">.</span><span class="n">elevation</span>
                                        <span class="k">if</span> <span class="n">pevent</span><span class="o">.</span><span class="n">datetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">addEvDat</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pevent</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NaN&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">iev</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
                        <span class="c1"># -- delete values with given QC flags</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteFlag</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{1}</span><span class="s2">.*&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="c1"># --- Delete empty columns</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
                        <span class="c1"># --- Preserve QC Flags in self.qcdata DataDrame and</span>
                        <span class="c1"># --- Replace Quality Flags for numeric columns</span>

                        <span class="k">for</span> <span class="n">paramcolumn</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">if</span> <span class="n">paramcolumn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">setQCDataFrame</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^[\?/\*#\&lt;\&gt;]&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="c1"># --- Adjust Column Data Types</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                                <span class="k">pass</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;Date/Time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;ISO8601&quot;</span><span class="p">)</span>
                                <span class="c1"># self.data[&#39;Date/Time&#39;] = pd.to_datetime(self.data[&#39;Date/Time&#39;], format=&#39;%Y-%m-%dT%H:%M:%S&#39;)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="c1"># try to preserve the year at least:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="sa">r</span><span class="s2">&quot;^.*([0-9]</span><span class="si">{4}</span><span class="s2">)</span><span class="si">{1}</span><span class="s2">.*$&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\1&quot;</span><span class="p">},</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Date/Time transformation failed: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                            <span class="k">pass</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Dataset seems to be a binary file which cannot be handled by pangaeapy&#39;})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Dataset seems to be a binary file which cannot be handled by pangaeapy&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
                        <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Data access failed, invalid auth token&#39;})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data access failed, invalid auth token&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Data access failed, authorisation failed &#39;})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data access failed, authorisation failed &quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">406</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data access failed, no tabular data available&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Data access failed, response code &#39;+(str(dataResponse.status_code))})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data access failed, response code &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dataResponse</span><span class="o">.</span><span class="n">status_code</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;ERROR&#39;:&#39;Loading data failed, reason: &#39;+str(e)})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Loading data failed, reason: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">setQCDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tmp_qc_column_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">paramcolumn</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">]:</span>
                    <span class="n">tmp_qc_series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(^[\*/\?])?(.+)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                    <span class="c1"># self.qcdata[paramcolumn] = self.data[paramcolumn].astype(</span>
                    <span class="c1">#    str).str.extract(r&#39;(^[\*/\?])?(.+)&#39;)[0]</span>
                    <span class="c1"># self.qcdata[paramcolumn].fillna(value=&#39;ok&#39;, inplace=True)</span>
                    <span class="n">tmp_qc_series</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality_flag_replace</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">tmp_qc_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">tmp_qc_series</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
                    <span class="n">tmp_qc_column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_qc_series</span><span class="p">)</span>
                    <span class="c1"># self.qcdata[paramcolumn].replace(to_replace=self.quality_flag_replace, inplace=True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">tmp_qc_column_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Could not create QC flag dataframe&#39;})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Could not create QC flag dataframe&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">addQCParamsAndColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc_suffix</span><span class="o">=</span><span class="s2">&quot;_QC&quot;</span><span class="p">,</span> <span class="n">excludeColumns</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># self.data.replace(regex=r&#39;^[\?/\*#\&lt;\&gt;]&#39;, value=&#39;&#39;, inplace=True)</span>
        <span class="k">if</span> <span class="n">excludeColumns</span><span class="p">:</span>
            <span class="n">joincolumns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">excludeColumns</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joincolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="n">qc_suffix</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">paramcolumn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="p">[</span><span class="n">joincolumns</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                <span class="n">ptype</span> <span class="o">=</span> <span class="s2">&quot;qc&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># geocodeqc</span>
                <span class="n">ptype</span> <span class="o">=</span> <span class="s2">&quot;gqc&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">paramcolumn</span> <span class="o">+</span> <span class="n">qc_suffix</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span> <span class="o">+</span> <span class="n">qc_suffix</span><span class="p">]</span> <span class="o">=</span> <span class="n">PanParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">qc_suffix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">paramcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">shortName</span> <span class="o">+</span> <span class="n">qc_suffix</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;pangaeapy&quot;</span><span class="p">,</span> <span class="n">param_type</span><span class="o">=</span><span class="n">ptype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setCitation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">citationURL</span> <span class="o">=</span> <span class="s2">&quot;https://doi.pangaea.de/10.1594/PANGAEA.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">cheaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/x-bibliography&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
            <span class="n">cheaders</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">citationURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">cheaders</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">citation</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.logging.append({&#39;WARNING&#39;:&#39;Could not retrieve citation info from PANGAEA&#39;})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Could not retrieve citation info from PANGAEA&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PanDataSet.setMetadata">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.setMetadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setMetadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method initializes the metadata of the PanDataSet object using the information of a PANGAEA metadata XML file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metaDataURL</span> <span class="o">=</span> <span class="s2">&quot;https://doi.pangaea.de/10.1594/PANGAEA.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">mheaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pangaea.metadata+xml&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
            <span class="n">mheaders</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metaDataURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">mheaders</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;HTTP request error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;WARNING&#39;:&#39;Received too many requests error (429)...&#39;})</span>
                <span class="n">sleeptime</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry-after&quot;</span><span class="p">):</span>
                    <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry-after&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">sleeptime</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Received too many (metadata) requests error (429)...waiting &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metaDataURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">mheaders</span><span class="p">)</span>
                <span class="c1"># self.logging.append({&#39;INFO&#39;:&#39;After repeating request, got status code: &#39;+str(r.status_code)})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;After repeating (metadata) request, got status code: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                    <span class="n">xmlText</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metaxml</span> <span class="o">=</span> <span class="n">xmlText</span>
                    <span class="n">xml</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xmlText</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                    <span class="c1"># dataset_status = None</span>
                    <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;status&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">datastatus</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;status&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastatus</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loginstatus</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;loginOption&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loginstatus</span> <span class="o">!=</span> <span class="s2">&quot;unrestricted&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
                                <span class="c1"># self.logging.append({&#39;INFO&#39;: &#39;Trying to load protected dataset using the given auth token&#39;})</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Trying to load protected dataset using the given auth token&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># self.logging.append({&#39;WARNING&#39;: &#39;Data set is protected&#39;})</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data set is protected&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;lastModified&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lastupdate</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;lastModified&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;collectionType&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Data set is of type collection, please select one of its child datasets&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">isCollection</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_setCollectionMembers</span><span class="p">()</span>

<span class="w">                        </span><span class="sd">&quot;&quot;&quot;hierarchyLevel=xml.find(&#39;./md:technicalInfo/md:entry[@key=&quot;hierarchyLevel&quot;]&#39;,self.ns)</span>
<span class="sd">                        if hierarchyLevel!=None:</span>
<span class="sd">                            if hierarchyLevel.get(&#39;value&#39;)==&#39;parent&#39;:</span>
<span class="sd">                                #self.logging.append({&#39;WARNING&#39;:&#39;Data set is of type parent, please select one of its child datasets&#39;})</span>
<span class="sd">                                self.log(logging.WARNING, &#39;Data set is of type collection, please select one of its child datasets&#39;)</span>
<span class="sd">                                self.isCollection=True</span>
<span class="sd">                                self._setCollectionMembers()&quot;&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:abstract&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:abstract&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">registrystatus</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;DOIRegistryStatus&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;moratoriumUntil&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">moratorium</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;./md:technicalInfo/md:entry[@key=&quot;moratoriumUntil&quot;]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:status/md:curationLevel/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">curationlevel</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:status/md:curationLevel/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:status/md:processingLevel/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">processinglevel</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:status/md:processingLevel/md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:year&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:year&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:dateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:dateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastupdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lastupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">doi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="c1"># extent</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:temporal/md:minDateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mintimeextent</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:temporal/md:minDateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:temporal/md:maxDateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">maxtimeextent</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:temporal/md:maxDateTime&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:westBoundLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;westBoundLongitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:westBoundLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:eastBoundLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;eastBoundLongitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:eastBoundLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:southBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;southBoundLatitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:southBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:northBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;northBoundLatitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:northBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:northBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;northBoundLatitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:northBoundLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:meanLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;meanLongitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:meanLongitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:meanLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">geometryextent</span><span class="p">[</span><span class="s2">&quot;meanLatitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:geographic/md:meanLatitude&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

                        <span class="n">topotypeEl</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:extent/md:topoType&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">topotypeEl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">topotype</span> <span class="o">=</span> <span class="n">topotypeEl</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">topotype</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:author&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                            <span class="n">lastname</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">firstname</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">orcid</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:lastName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">lastname</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:lastName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:firstName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">firstname</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:firstName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:orcid&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">orcid</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:orcid&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="c1"># if author.find(&quot;md:affiliation&quot;, self.ns)!=None:</span>
                            <span class="n">authoraffiliations</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">affiliations</span> <span class="ow">in</span> <span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;md:affiliation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                                <span class="n">afm</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.inst([0-9]+)$&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">affiliations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)))</span>
                                <span class="k">if</span> <span class="n">afm</span><span class="p">:</span>
                                    <span class="n">authoraffiliations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">afm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="c1"># print(authoraffiliations)</span>
                            <span class="n">authorid</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">authorid</span><span class="p">:</span>
                                <span class="n">authorid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">authorid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;dataset.author&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PanAuthor</span><span class="p">(</span><span class="n">lastname</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">orcid</span><span class="p">,</span> <span class="n">authorid</span><span class="p">,</span> <span class="n">authoraffiliations</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:project&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">URI</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">awardURI</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">URI</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:award/md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">awardURI</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:award/md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
                                <span class="n">projectid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PanProject</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">URI</span><span class="p">,</span> <span class="n">awardURI</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">projectid</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:license&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">license</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:license&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">URI</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">label</span> <span class="o">=</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">URI</span> <span class="o">=</span> <span class="n">license</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">licence</span> <span class="o">=</span> <span class="n">PanLicence</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">URI</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:reference&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                            <span class="n">refURI</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">reftitle</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">reftype</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relationType&quot;</span><span class="p">)</span>
                            <span class="n">refid</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">refURI</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">reftitle</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">refid</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">reftitle</span><span class="p">,</span> <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">refURI</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">reftype</span><span class="p">})</span>
                        <span class="k">if</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:supplementTo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">suppl</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./md:citation/md:supplementTo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                            <span class="n">suppURI</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">supptitle</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">suppyear</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">suppid</span> <span class="o">=</span> <span class="n">suppl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:year&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">suppyear</span> <span class="o">=</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:year&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">supptitle</span> <span class="o">=</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:title&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="k">if</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">suppURI</span> <span class="o">=</span> <span class="n">suppl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;md:URI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">supplement_to</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suppid</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">supptitle</span><span class="p">,</span> <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">suppURI</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">suppyear</span><span class="p">}</span>
                        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:keywords/md:keyword&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">):</span>
                            <span class="c1"># Only iterate over actual `md:keyword`; ignore, e.g., `md:techKeyword`.</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                        <span class="n">panXMLMatrixColumn</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:matrixColumn&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="n">panXMLMatrixColumn</span><span class="p">)</span>
                        <span class="n">panXMLEvents</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./md:event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_setEvents</span><span class="p">(</span><span class="n">panXMLEvents</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_setCitation</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Dataset is deleted or of unknown status: &#39; + str(self.datastatus)})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Dataset is deleted or of unknown status: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datastatus</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Failed to retrieve metadata information: &#39;+str(e)})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Failed to retrieve metadata information: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">ET</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Failed to parse metadata information: &#39;+str(e)})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Failed to parse metadata information: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print( str(xmlText))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self.logging.append({&#39;ERROR&#39;: &#39;Data set does not exist, 404&#39;})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;Data set does not exist, 404: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;No HTTP response object received for: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_setCollectionMembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cheaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
            <span class="n">cheaders</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>
        <span class="n">childqueryURL</span> <span class="o">=</span> <span class="s2">&quot;https://www.pangaea.de/advanced/search.php?q=incollection:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&amp;count=1000&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">childqueryURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">cheaders</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">collection_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;URI&quot;</span><span class="p">])</span>
                <span class="c1"># print(p[&#39;URI&#39;])</span>

<div class="viewcode-block" id="PanDataSet.getGeometry">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.getGeometry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sometimes the topotype attribute has not been set correctly during the curation process.</span>
<span class="sd">        This method returns the real geometry (topographic type) of the dataset based on the x,y,z and t information of the data frame content.</span>
<span class="sd">        Still a bit experimental..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geotype</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">zgroup</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">]</span>
        <span class="n">tgroup</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">]</span>
        <span class="n">locgrp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Longitude&quot;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pz</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">locgrp</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;Date_Time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;Date_Time&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Depth_water&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Depth_water&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Depth&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Depth&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Depth_ice_snow&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Depth_ice_snow&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;Depth_soil&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Depth_soil&quot;</span>

        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tgroup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">tgroup</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zgroup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">pz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">zgroup</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pt</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">pz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;point&quot;</span>
            <span class="k">elif</span> <span class="n">pt</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pz</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;timeSeries&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;timeSeriesStack&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;profile&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">pz</span><span class="p">:</span>
                <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;trajectory&quot;</span>
            <span class="k">elif</span> <span class="n">pt</span> <span class="o">&gt;</span> <span class="n">pz</span><span class="p">:</span>
                <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;timeSeriesProfile&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">geotype</span> <span class="o">=</span> <span class="s2">&quot;trajectoryProfile&quot;</span>
        <span class="k">return</span> <span class="n">geotype</span></div>


<div class="viewcode-block" id="PanDataSet.getParamDict">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.getParamDict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getParamDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The method returns translates the parameter object list into a dictionary&quot;&quot;&quot;</span>
        <span class="n">paramdict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shortName&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">param_key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">paramdict</span><span class="p">[</span><span class="s2">&quot;shortName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_key</span><span class="p">)</span>
            <span class="n">paramdict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_value</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">paramdict</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_value</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">paramdict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_value</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">paramdict</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_value</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paramdict</span></div>


<div class="viewcode-block" id="PanDataSet.info">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The method returns a set of basic information about the PANGAEA dataset&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Citation:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Toptype:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topotype</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
        <span class="n">paramdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParamDict</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">paramdf</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data: (first 5 rows)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">rename_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span><span class="o">.</span><span class="n">shortName</span> <span class="o">=</span> <span class="n">new_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_name</span><span class="p">:</span> <span class="n">new_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcdata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_name</span><span class="p">:</span> <span class="n">new_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="PanDataSet.to_netcdf">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.to_netcdf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_netcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filelocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;sdn&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a NetCDF file using PANGAEA data. It offers two different flavors: SeaDataNet NetCDF and an</span>
<span class="sd">        experimental internal format using NetCDF 4 groups.</span>
<span class="sd">        Currently the method only supports simple types such as timeseries and profiles.</span>
<span class="sd">        The method created files are named as follows: [PANGAEA ID]_[type].cf</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filelocation : str</span>
<span class="sd">            Indicates the location (directory) where the NetCDF file will be saved</span>
<span class="sd">        type : str</span>
<span class="sd">            This parameter sets the NetCDF profile type. Allowed values are &#39;sdn&#39; (SeaDataNet) and &#39;pan&#39; (PANGAEA style)</span>
<span class="sd">        save : Boolean</span>
<span class="sd">            If the file shall be saved on disk (filelocation or home directory/pan_export by default)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">netcdfexporter</span> <span class="o">=</span> <span class="n">PanNetCDFExporter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;sdn&quot;</span><span class="p">:</span>
            <span class="n">netcdfexporter</span><span class="o">.</span><span class="n">renameSDNDimVars</span><span class="p">()</span>
            <span class="n">netcdfexporter</span><span class="o">.</span><span class="n">pandataset</span><span class="o">.</span><span class="n">addQCParamsAndColumns</span><span class="p">(</span><span class="n">qc_suffix</span><span class="o">=</span><span class="s2">&quot;_SEADATANET_QC&quot;</span><span class="p">,</span> <span class="n">excludeColumns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;TIME&quot;</span><span class="p">])</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">netcdfexporter</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">netcdfexporter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="PanDataSet.to_frictionless">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.to_frictionless">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_frictionless</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filelocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a frictionless data package (https://specs.frictionlessdata.io/data-package) file using PANGAEA metadata and data.</span>
<span class="sd">        A package will be saved as directory</span>
<span class="sd">        The method created directories are named as follows: [PANGAEA ID]_frictionless</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filelocation : str</span>
<span class="sd">            Indicates the location (directory) where the frictionless file will be saved</span>
<span class="sd">        save : Boolean</span>
<span class="sd">            If the file shall be saved on disk (filelocation or home directory/pan_export by default)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frictionless_exporter</span> <span class="o">=</span> <span class="n">PanFrictionlessExporter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filelocation</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">frictionless_exporter</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">frictionless_exporter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="PanDataSet.to_dwca">
<a class="viewcode-back" href="../../api_documentation.html#pangaeapy.pandataset.PanDataSet.to_dwca">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_dwca</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a Darwin Core Archive file using PANGAEA metadata and data.</span>
<span class="sd">        A package will be saved as directory</span>
<span class="sd">        The method created directories are named as follows: [PANGAEA ID]_dwca</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filelocation : str</span>
<span class="sd">            Indicates the location (directory) where the DwC-A file will be saved</span>
<span class="sd">        save : Boolean</span>
<span class="sd">            If the file shall be saved on disk (filelocation or home directory/pan_export by default)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dwca_exporter</span> <span class="o">=</span> <span class="n">PanDarwinCoreAchiveExporter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">dwca_exporter</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">dwca_exporter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># print(dwca_exporter.logging)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dwca_exporter</span><span class="o">.</span><span class="n">logging</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Robert Huber, Uwe Schindler, Niklas Selke, Johannes Röttenbacher.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>